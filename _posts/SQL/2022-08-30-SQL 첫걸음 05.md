---
title:  "SQL 첫걸음 5장"
excerpt: "데이터의 추가, 삭제, 갱신"

categories:
  - SQL
tags:
  - [SQL]
toc: true
toc_sticky: true
toc_label: "목차"
date: 2022.08.30 18:30:00
---

# 20. 행 개수 구하기 - COUNT

SQL은 데이터베이스라 불리는 데이터 집합을 다루는 언어    
집합의 개수나 합계 등을 구할 때 집계함수인 `COUNT` / `SUM` / `AVG` / `MIN` / `MAX` 등을 사용할 수 있음    
집계함수는 인수로 집합을 지정하기 때문에 집합함수라고도 불림    

## COUNT로 행 개수 구하기
`COUNT` : 인수로 주어진 집합의 개수를 반환
`SELECT COUNT(*) FROM 테이블명`의 형태로 사용    
* `*` : 모든 열을 나타낼 때 사용하는 메타문자, `COUNT`에 사용시 테이블 전체라는 의미로 사용
* 인수로 지정된 집합의 개수를 계산함

집계함수는 집합으로부터 하나의 값을 반환하므로 `WHERE`구의 유무와 관계없이 하나의 행만을 결과값으로 반환함    

## 집계함수와 NULL값

`COUNT`의 인수로 열명을 지정시 해당 열에 한해서 행의 개수를 구함    
* 단, 이때 `NULL`값이 있을 경우 이를 제외하고 처리함
* 단! `COUNT(*)`의 경우 모든 열의 행수를 카운트하므로 `NULL`값이 있어도 무시되지 않음

## DISTINCT로 중복 제거
`DISTINCT` : 중복된 값을 제거하고 출력
`SELECT DISTINCT 행명 FROM 테이블명`의 형태로 사용, 중복된 데이터를 제외한 결과를 클라이언트로 반환    
`DISTINCT` 대신 `ALL`을 사용할 경우 모든 행을 반환하며, 생략시 `ALL`으로 간주됨    

집계함수에서 `DISCTINCT`를 사용할 때는 집계함수의 인수로 `DISTINCT`를 사용한 수식을 지정    
`SELECT COUNT(DISTINCT 열명) FROM 테이블명`의 형태로 사용    


***


# 21. COUNT 이외의 집계함수

## SUM으로 합계 구하기
`SUM` : 집합의 합계를 구함    
`SELECT SUM(열명) FROM 테이블명`의 형태로 사용    
* 수치형에만 사용 가능 
* `NULL`값은 무시함 

## AVG로 평균내기
`AVG` : 집합의 평균을 구함    
`SELECT AVG(열명) FROM 테이블명`의 형태로 사용
* `SUM()/COUNT()`와 동일한 결과
* 수치형만 가능하며, `NULL`값을 제거한 뒤에 평균값을 계산함
* `NULL`값을 0으로 간주하고싶다면 `CASE`를 사용해 `NULL`을 0으로 변환한 뒤에 계산

## MIN/MAX로 최솟값/최댓값 구하기
`SELECT MIN/MAX(열명) FROM 테이블명`의 형태로 사용    
수치형 뿐만 아니라 문자열형 및 날짜시간형에도 사용할 수 있음    
단, 다른 집계함수들과 동일하게 `NULL`값은 무시함    


***


22. 그룹화 - GROUP BY














## 값을 저장할 열 지정하기

`INSERT INTO 테이블명(열1, 열2, ...) VALUES(값1, 값2, ...)`의 형식으로 값을 추가할 열을 지정할 수 있음    
* 이 때 `VAULES` 구에는 지정한 열과 동일한 개수의 값을 사용해야함
* 지정하지 않은 열에는 기본값인 `NULL`이 저장됨    

## NOT NULL 제약
`VALUES` 구로 추가할 값을 `NULL`로 지정할 경우 에러가 발생할 수 있음    
이는 `NOT NULL`제약이 걸려있을 수 있기 때문임    
제약은 테이블에 저장하는 데이터를 설정을 통해 제한하는 것을 뜻하며, `NOT NULL` 이외에도 다양한 제약들이 존재함    

## DEFAULT
Default : 명시적으로 값을 지정하지 않았을 경우 사용하는 초깃값    
* 테이블을 정의할 때 지정할 수 있음
* 열을 지정해 행을 추가할시, 추가할 데이터를 명시하지 않은 열은 Default 값을 사용하여 저장됨
* `VALUES` 구에 넣을 값을 `DEFAULT`로 명시적으로 지정할 수도 있음


***


# 17. 삭제하기 - DELETE

하드디스크와 같은 저장장치에 데이터를 저장해 관리하는 데이터베이스의 특성상 데이터를 무제한으로 저장할 수 없음    
따라서 저장공간 문제로 인해 데이터를 삭제해야하는 경우가 자주 발생함    

## DELETE로 행 삭제하기
`DELETE` : 행 단위로 데이터 삭제     
`DELETE FROM 테이블명 WHERE 조건식`의 형식으로 사용    
* 데이터 삭제 전 `SELECT` 명령으로 어떤 데이터가 저장되어있는지 확인
* `WHERE`구를 생략하면 모든 행을 대상으로 동작하여 테이블의 모든 데이터가 삭제됨
* 열을 지정할 수는 없음

## DELETE 명령 구
`WHERE` 구에 조건을 지정하여 삭제할 행을 선택할 수 있음    
단, 어떤 행부터 삭제할지는 의미가 없기 때문에 `ORDER BY`구는 사용할 수 없음    


***


# 18. 데이터 갱신하기 - UPDATE

## UPDATE로 데이터 갱신하기
`UPDATE` : 테이블의 셀 값을 갱신    
`UPDATE 테이블명 SET 열명 = 값 WHERE 조건식`의 형식으로 사용    
* `DELETE`와 달리 셀 단위로 데이터 갱신 가능
* `WHERE` 구를 생략할 경우 테이블의 모든 행이 갱신
* `SET` 구를 사용하여 갱신할 열과 값을 지정
	* `SET 열명 = 값`에서 `=`은 대입 연산자
	* 테이블에 존재하지 않는 열 지정시 에러가 발생
	* 자료형에 맞는 값을 지정해야 함

## UPDATE로 갱신할 경우 주의사항
`UPDATE` 명령은 이미 존재하는 행에 대해 값을 갱신하므로 이전의 값과 이후의 값이라는 두가지 상태가 존재함    
`UPDATE 테이블 SET no=no+1;` 의 경우 갱신 후의 값은 본래값(갱신 전의 값)에서 1을 더한 결과가 됨    

## 복수열 갱신

`SET` 구에서는 필요에 따라 콤마로 갱신할 열을 복수 지정할 수 있음    
이 때 데이터베이스 별로 갱신 처리를 하는 순서가 달라짐    
* `Oracle`의 경우 기술한 식의 순서가 처리에 영향을 주지 않음
* `MySQL`의 경우 `SET`구에 기술된 순서로 갱신 처리가 일어남

## NULL로 갱신하기
갱신할 값으로 `NULL`을 지정하는 경우 `NULL 초기화`라고 부르기도 함    
단, `NOT NULL`제약이 있는 경우에는 허용되지 않음    


***


# 19. 물리삭제와 논리삭제

데이터베이스에서 데이터를 삭제하는 방법에는 물리삭제와 논리삭제가 있음    
단, 전용 SQL명령이 존재하지는 않음    

## 두 종류의 삭제방법
물리삭제 : SQL의 `DELETE` 명령을 사용해 직접 데이터를 삭제하는 방식
논리삭제 : 테이블에 '삭제플래그'와 같은 열을 두어 해당 열의 데이터를 갱신해둠    
	즉, 실제 데이터는 테이블 안에 남아있으나 데이터베이스를 참조할 때는 삭제플래그가 설정된 행을 제외하여 삭제된 것처럼 보이게 만듬    
* 실제로 데이터를 삭제하는 것이 아니므로 간단하게 백업이 가능함
* 삭제시에도 데이터베이스의 저장공간이 줄어들지 않으며 검색속도가 떨어질 수 있음

## 삭제방법 선택하기
시스템의 특성 / 테이블에 저장된 데이터의 특성에 따라 달라지므로 상황에 맞게 선택해야함    
* 개인정보를 다룰 시 물리삭제가 안전
* 주문 취소시에는 논리삭제하여 통계 등에 활용





